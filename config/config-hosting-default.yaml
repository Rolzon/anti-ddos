# Anti-DDoS Configuration - HOSTING DEFAULT (Multi-Servicios)
# Versión: 2.0 Balanced
# Fecha: 2024-11-21
#
# Perfil recomendado para hosting con clientes mixtos (Minecraft, Rust, Web, Bases de datos, etc).
# Objetivo: protección eficiente sin penalizar servicios variados. Ajustar valores por cliente
# usando "services.definitions" o auto-discovery.

# General Settings
general:
  log_level: INFO
  log_file: /var/log/antiddos/antiddos.log
  pid_file: /var/run/antiddos.pid
  check_interval: 5  # Intervalo más conservador (menos CPU)

# Bandwidth Monitoring - Protección Global
bandwidth:
  enabled: true
  interface: dr0
  threshold_mbps: 200    # Umbral global (ataques reales >400 Mbps)
  threshold_pps: 65000   # Ataques DDoS globales
  window_seconds: 10
  auto_mitigate: true

# Country Filtering (opcional)
country_filter:
  enabled: true
  mode: blacklist  # blacklist or whitelist
  # Blacklist mode: block these countries
  blacklist:
    - CN  # China
    - RU  # Russia
    - KP  # North Korea
  # Whitelist mode: only allow these countries
  whitelist:
    - US
    - CA
    - GB
    - DE
    - FR
  # Trigger country filter when bandwidth exceeds threshold
  trigger_on_bandwidth: true
  trigger_threshold_mbps: 150  # Activar filtrado cuando haya ataque serio

# Global Blacklist
global_blacklist:
  enabled: true
  file: /etc/antiddos/blacklist.txt
  auto_save: true
  auto_blacklist:
    enabled: true
    connections_per_second: 120
    duration_seconds: 3600

# DoS Filter (balanceado)
dos_filter:
  enabled: true
  syn_flood:
    enabled: true
    threshold: 120  # Por IP
  udp_flood:
    enabled: true
    threshold: 180  # Global (1.8k pps)
  icmp_flood:
    enabled: true
    threshold: 20
  connection_limit:
    enabled: true
    max_connections: 120  # Por IP (TCP)

# SSH Protection
ssh_protection:
  enabled: true
  log_file: /var/log/auth.log
  max_attempts: 2
  ban_time: 21600
  find_time: 600

# Whitelist
whitelist:
  enabled: true
  ips:
  - 217.216.64.51
  - 147.93.147.175
  - 190.57.138.18
  - 190.110.48.34  
  file: /etc/antiddos/whitelist.txt

# Servicios (auto-discovery + overrides)
services:
  enabled: true
  default_threshold_mbps: 25     # válido para juegos, web, APIs
  default_threshold_pps: 3000
  status_file: /var/run/antiddos/service_stats.json
  window_seconds: 12
  recovery_cycles: 4
  default_interface: dr0

  auto_rate_limit:
    enabled: true
    limit_pps: 2500

  auto_udp_block:
    enabled: true
    min_pps: 9000
    ban_connection_threshold: 60
    ban_duration_seconds: 1200

  auto_blacklist:
    enabled: true
    min_connections: 55
    duration_seconds: 3600

  auto_discovery:
    enabled: true
    mode: docker
    refresh_seconds: 90
    docker:
      binary: docker
      default_interface: dr0

  definitions: []  # Agregar overrides específicos por servicio/cliente

# Notifications
notifications:
  enabled: true
  discord:
    enabled: true
    webhook_url: "https://discord.com/api/webhooks/1437262661199986750/BtoGq7zNOaYosRg_LviFwkIis1E74gC6zuRkMnvkKEqo8Xzr2b422j0wmJlFdytOVuV3"
    notify_attacks: true
    notify_mitigations: true
    notify_blocks: true
    send_daily_report: true
    report_time: "10:00"
  email:
    enabled: false
  webhook:
    enabled: false

# Advanced settings
advanced:
  use_conntrack: true
  max_conntrack_entries: 150000
  kernel_hardening: true
  allowed_ports:
    - 22
    - 80
    - 443
    - 3306
    - 5432
    - 6379
    - 25565
  mysql:
    port: 3306
    allow_server_public_ip: true
    server_public_ip: "190.57.138.18"
    max_connections_per_ip: 20
    rate_limit: "20/s"
    rate_limit_burst: 60
    trusted_ips:
      - 190.57.138.18
      - 190.110.48.34
  wings_api:
    port: 8080
    protection_enabled: true
    rate_limit: "25/s"
    rate_limit_burst: 80
    trusted_ips:
      - 190.57.138.18
      - 190.110.48.34
  strict_limits:
    enabled: true
    burst_multiplier: 3
    syn_limit: 4000
    udp_limit: 12000
    icmp_limit: 700
